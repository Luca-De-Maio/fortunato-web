---
import "../styles/global.css";
const { title = "Fortunato", description = "Moda masculina premium" } = Astro.props;
---
<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{title}</title>
    <meta name="description" content={description} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="/placeholder.svg" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      rel="preload"
      as="style"
      href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600&family=Outfit:wght@300;400;500;600&display=swap"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600&family=Outfit:wght@300;400;500;600&display=swap"
      rel="stylesheet"
      media="print"
      onload="this.media='all'"
    />
    <noscript>
      <link
        href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600&family=Outfit:wght@300;400;500;600&display=swap"
        rel="stylesheet"
      />
    </noscript>
  </head>
  <body>
    <div class="grain"></div>
    <slot />
    <a class="whatsapp-fab" href="https://wa.me/5491132585919" aria-label="WhatsApp Fortunato">
      <svg viewBox="0 0 32 32" aria-hidden="true" focusable="false">
        <path d="M16 3.2c-6.5 0-11.8 5.2-11.8 11.7 0 2.1.6 4.1 1.6 5.9L4.1 28l7.4-1.9c1.7.9 3.6 1.4 5.5 1.4 6.5 0 11.8-5.2 11.8-11.7S22.5 3.2 16 3.2zm0 21.1c-1.8 0-3.5-.5-5-1.3l-.4-.2-4.3 1.1 1.2-4.1-.2-.4c-.9-1.5-1.4-3.2-1.4-5 0-5.1 4.2-9.3 9.3-9.3 2.5 0 4.8 1 6.6 2.7 1.8 1.8 2.7 4.1 2.7 6.6 0 5.1-4.2 9.3-9.3 9.3zm5.2-6.9c-.3-.2-1.8-.9-2.1-1-.3-.1-.5-.2-.7.2-.2.3-.8 1-.9 1.2-.2.2-.3.2-.6.1-.3-.2-1.2-.5-2.3-1.6-.9-.8-1.4-1.8-1.6-2.1-.2-.3 0-.5.2-.6.2-.2.3-.3.5-.5.2-.2.3-.3.4-.5.2-.2.2-.4.1-.6-.1-.2-.7-1.7-1-2.3-.3-.6-.5-.5-.7-.5h-.6c-.2 0-.5.1-.7.3-.2.2-.9.8-.9 2 0 1.2.9 2.4 1 2.6.1.2 1.8 3 4.4 4.2.6.3 1.1.4 1.5.6.6.2 1.2.2 1.6.1.5-.1 1.8-.7 2-1.4.2-.6.2-1.2.1-1.3-.1-.2-.3-.2-.6-.4z"/>
      </svg>
      <span>WhatsApp</span>
    </a>
    <script>
      const CART_KEY = "fortunato_cart";
      const getCart = () => {
        try { return JSON.parse(localStorage.getItem(CART_KEY) || "[]"); } catch { return []; }
      };
      const setCart = (items) => localStorage.setItem(CART_KEY, JSON.stringify(items));

      const updateBadge = () => {
        const badge = document.querySelector("[data-cart-count]");
        if (!badge) return;
        const count = getCart().reduce((sum, item) => sum + item.qty, 0);
        badge.textContent = count ? String(count) : "";
        badge.classList.toggle("is-visible", count > 0);
      };

      const addToCart = (payload) => {
        const cart = getCart();
        const existing = cart.find((i) => i.id === payload.id);
        if (existing) existing.qty += 1;
        else cart.push({ ...payload, qty: 1 });
        setCart(cart);
        updateBadge();
      };

      const setupHeaderScroll = () => {
        const header = document.querySelector(".site-header");
        if (!header) return;
        const mq = window.matchMedia("(max-width: 760px)");

        const update = () => {
          if (!mq.matches) {
            header.classList.remove("is-scrolled");
            return;
          }
          header.classList.toggle("is-scrolled", window.scrollY > 40);
        };

        update();
        window.addEventListener("scroll", update, { passive: true });
        if (mq.addEventListener) mq.addEventListener("change", update);
        else mq.addListener(update);
      };

      document.addEventListener("click", (event) => {
        const button = event.target.closest("[data-add-to-cart]");
        if (!button) return;
        const payload = {
          id: button.dataset.id,
          name: button.dataset.name,
          price: Number(button.dataset.price || 0),
          currency: button.dataset.currency || "ARS",
          image: button.dataset.image || "/placeholder.svg"
        };
        addToCart(payload);
        button.textContent = "Agregado";
        setTimeout(() => (button.textContent = "Agregar al carrito"), 1200);
      });

      updateBadge();
      setupHeaderScroll();
    </script>
  </body>
</html>
